package main

import (
	"compress/flate"
	"compress/zlib"
	"fmt"
	"io/ioutil"
	"os"
)

func main() {

	fmt.Println("-----å‹ç¼©æ–‡ä»¶å¹¶ä¸”è¯»å–å‹ç¼©åçš„æ•°æ®------")
	dst_file, e := os.Create("main/zlib/zlib01_compress.txt")
	check_err_zlib(e)
	// NewWriteråˆ›å»ºä¸€ä¸ªæ–°çš„Writerã€‚
	//å‹ç¼©è¿”å›çš„Writerå¹¶å°†å…¶å†™å…¥wã€‚
	//
	//å®Œæˆåï¼Œè°ƒç”¨æ–¹æœ‰è´£ä»»åœ¨Writerä¸Šè°ƒç”¨Closeã€‚
	//å†™å…¥å¯èƒ½ä¼šè¢«ç¼“å†²ï¼Œç›´åˆ°å…³é—­æ‰åˆ·æ–°ã€‚
	//åº•å±‚å®ç°æ˜¯é€šè¿‡ï¼šNewWriterLevelDict()æ–¹æ³•
	//w := zlib.NewWriter(dst_file)
	//é™¤äº†NewWriterä¹‹å¤–è¿˜æœ‰ï¼š
	//zlib.NewWriterLevel()


	dict:=[]byte{'a','b','c','d','e','f'}

	// NewWriterLevelDictç±»ä¼¼äºNewWriterLevelï¼Œä½†æŒ‡å®šè¦å‹ç¼©çš„å­—å…¸ã€‚
	//å­—å…¸å¯èƒ½ä¸ºnilã€‚ å¦‚æœæ²¡æœ‰ï¼Œåˆ™åœ¨å…³é—­Writerä¹‹å‰ï¼Œä¸å¾—ä¿®æ”¹å…¶å†…å®¹ã€‚
	w, e := zlib.NewWriterLevelDict(dst_file, flate.BestCompression, dict)// flate.BestCompression=9
	check_err_zlib(e)

	src_bytes, e := ioutil.ReadFile("main/zlib/zlib01.txt")
	check_err_zlib(e)

	n, e := w.Write(src_bytes)
	check_err_zlib(e)
	//å…³äºwçš„å…¶ä»–æ–¹æ³•,ä¸å†ç´¯å™ï¼š
	//	w.Flush()
	//	w.Reset()
	e = w.Close() //è¿™ä¸ªclose()ä¸èƒ½æ”¾åˆ°deferä¸­å»ï¼Œå› ä¸ºä¸‹é¢è¦ç›´æ¥è¿›è¡Œè¯»å–äº†ï¼Œå¦‚æœæ”¾åˆ°è¯»å–åæ‰close()æ˜¯æ— æ³•è¯»å–æ­£ç¡®çš„ï¼
	check_err_zlib(e)
	fmt.Println("å†™å…¥å‹ç¼©æ–‡ä»¶çš„å­—èŠ‚æ•°æ˜¯ï¼š", n)

	ret, e := dst_file.Seek(0, 0)
	check_err_zlib(e)

	fmt.Println("å°†å‹ç¼©æ–‡ä»¶çš„è¯»å†™æŒ‡é’ˆé‡ç½®åˆ°ï¼š", ret)

	// ReadAllä»rè¯»å–ç›´åˆ°å‡ºç°é”™è¯¯æˆ–EOFï¼Œç„¶åè¿”å›è¯»å–çš„æ•°æ®ã€‚
	//æˆåŠŸçš„è°ƒç”¨è¿”å›err == nilï¼Œè€Œä¸æ˜¯err == EOFã€‚ å› ä¸ºReadAllè¢«å®šä¹‰ä¸ºä»srcè¯»å–ç›´åˆ°EOFï¼Œæ‰€ä»¥å®ƒä¸ä¼šå°†è¯»å–çš„EOFè§†ä¸ºè¦æŠ¥å‘Šçš„é”™è¯¯ã€‚

	dst_byte, e := ioutil.ReadAll(dst_file) //é€šè¿‡è¿™ä¸ªå¯ä»¥ç›´æ¥è¯»å–åˆ°ï¼Œè¯»å†™æ–‡ä»¶æ¯”è¾ƒå¥½ç”¨çš„apiåœ¨è¿™ä¸ªioutilåŒ…é‡Œé¢
	check_err_zlib(e)

	fmt.Println("è¯»å–åˆ°çš„å‹ç¼©æ–‡ä»¶çš„å­—èŠ‚æ•°ä¸ºï¼š", len(dst_byte))
	fmt.Println("å‹ç¼©æ–‡ä»¶çš„å­—èŠ‚ä¸ºï¼š", dst_byte)
	fmt.Println("å‹ç¼©æ–‡ä»¶çš„å­—ç¬¦ä¸²ä¸ºï¼š", string(dst_byte))
	// è¾“å‡ºï¼š
	// 	å†™å…¥å‹ç¼©æ–‡ä»¶çš„å­—èŠ‚æ•°æ˜¯ï¼š 597
	// 	å°†å‹ç¼©æ–‡ä»¶çš„è¯»å†™æŒ‡é’ˆé‡ç½®åˆ°ï¼š 0
	// 	è¯»å–åˆ°çš„å‹ç¼©æ–‡ä»¶çš„å­—èŠ‚æ•°ä¸ºï¼š 424
	// 	å‹ç¼©æ–‡ä»¶çš„å­—èŠ‚ä¸ºï¼š [120 156 92 144 95 114 218 60 20 197 223 191 153 111 145 73 186 131 110 64 128 27 254 196
	// 			49 54 1 74 44 39 20 6 166 52 19 27 147 18 42 100 27 237 37 220 35 137 39 182 208 49 120 104 167 35 189 221
	// 			123 238 239 156 115 117 125 67 242 149 196 16 60 166 60 52 161 3 223 1 47 116 116 135 238 157 109 174 41
	// 			155 219 116 170 157 238 158 213 41 27 218 201 194 204 228 49 119 117 244 138 85 231 34 164 108 254 193 34
	// 			147 41 219 126 51 253 177 94 103 199 220 53 59 143 68 129 100 3 30 127 176 39 18 146 68 118 152 142 202 209
	// 			219 14 197 15 35 127 33 104 237 89 77 183 124 253 28 145 72 205 100 176 103 245 255 255 67 180 64 206 176
	// 			29 32 239 146 232 28 115 151 68 12 94 148 63 217 144 200 32 98 218 126 179 42 192 246 39 216 4 203 28 95
	// 			86 240 93 100 210 38 187 138 28 165 198 111 32 217 124 254 116 126 224 113 9 123 118 144 73 146 210 172 50
	// 			4 133 85 254 89 74 197 195 158 213 173 122 212 163 37 9 134 72 234 97 83 143 60 146 189 67 123 109 66 167
	// 			138 199 57 229 97 233 72 53 172 226 36 111 171 202 170 229 153 126 175 149 148 52 128 106 24 46 14 44 68
	// 			207 61 107 225 183 168 136 254 161 160 197 245 48 181 247 99 235 55 74 202 247 64 119 216 133 130 213 192
	// 			120 41 201 219 138 126 154 66 246 77 127 81 46 239 60 204 11 180 239 245 227 242 84 220 223 135 237 123
	// 			106 21 183 205 23 227 108 76 232 80 241 112 120 113 255 216 23 49 102 67 155 40 36 83 211 95 64 53 180
	// 			51 70 247 171 241 150 164 158 72 120 232 6 37 156 11 146 189 115 214 61 171 145 148 36 188 243 77 244 92
	// 			155 158 202 155 57 23 47 87 215 55 191 3 0 0 255 255 199 140 166 74]
	// 	å‹ç¼©æ–‡ä»¶çš„å­—ç¬¦ä¸²ä¸ºï¼š xï¿½\ï¿½_rï¿½<ï¿½ß¿ï¿½oï¿½Iï¿½ï¿½n@ï¿½ï¿½ï¿½16J,'ï¿½4ï¿½*dï¿½%ï¿½#ï¿½'ï¿½ï¿½1xhï¿½#ï¿½ï¿½{ï¿½ï¿½su}Cï¿½ï¿½<ï¿½<4ï¿½ï¿½/ttï¿½ï¿½mï¿½)ï¿½ï¿½tï¿½ï¿½ï¿½ï¿½)ï¿½ï¿½ï¿½ï¿½ï¿½1wu
	// 	ï¿½Uï¿½"ï¿½lï¿½ï¿½"ï¿½)ï¿½~3ï¿½ï¿½^gï¿½ï¿½5;ï¿½Dï¿½dï¿½'ï¿½Dvï¿½ï¿½ï¿½ï¿½ï¿½ï¿½#!hï¿½YMï¿½|ï¿½ï¿½Hï¿½dï¿½gï¿½ï¿½ï¿½Cï¿½@Î° ï¿½ï¿½sï¿½D^ï¿½?Ùï¿½ bï¿½~ï¿½*ï¿½ï¿½'ï¿½ï¿½_Vï¿½]dï¿½&ï¿½ï¿½ï¿½ï¿½o ï¿½|ï¿½t~ï¿½q	{v
	// 	ï¿½Iï¿½Ò¬2ï¿½Uï¿½YJï¿½ÃÕ­zÔ£%	ï¿½Hï¿½aSï¿½<ï¿½ï¿½C{mBï¿½ï¿½ï¿½9ï¿½aï¿½H5ï¿½ï¿½$oï¿½Êªï¿½~ï¿½ï¿½ï¿½4ï¿½j.,Dï¿½=ká·¨ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½0ï¿½ï¿½cï¿½7Jï¿½ï¿½@wØ…ï¿½ï¿½ï¿½x)ï¿½ÛŠ~ï¿½Bï¿½MQ.ï¿½<ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Tï¿½ß‡ï¿½{jï¿½ï¿½ï¿½l
	// 	Lï¿½Pï¿½pxqï¿½ï¿½1fCï¿½($Sï¿½_@5ï¿½3Fï¿½ï¿½ñ–¤Hxï¿½%ï¿½ï¿½ï¿½sï¿½=ï¿½ï¿½ï¿½$ï¿½ï¿½Mï¿½\ï¿½ï¿½Ê›9/Wï¿½7ï¿½
	fmt.Println()
	fmt.Println("-------è§£å‹å¹¶ä¸”è¯»å–å‡ºæ¥---------")

	ret1, e := dst_file.Seek(0, 0)
	check_err_zlib(e)

	fmt.Println("å°†å‹ç¼©æ–‡ä»¶çš„è¯»å†™æŒ‡é’ˆé‡ç½®åˆ°ï¼š", ret1)

	//ReadCloser, e := zlib.NewReader(dst_file)//æ— å­—å…¸æ—¶å€™å¯ä»¥ç”¨ï¼Œæœ‰å­—å…¸æ—¶å€™æ— æ³•è§£å‹äº†
	ReadCloser, e := zlib.NewReaderDict(dst_file,dict)
	//ReadCloser, e := zlib.NewReaderDict(dst_file,[]byte{'a','b','c','d','e'})//å­—å…¸å¿…é¡»è·Ÿå‹ç¼©æ—¶å€™çš„å­—å…¸ä¸€è‡´æ‰èƒ½æ­£å¸¸çš„è§£å‹
	read_dst_byte := make([]byte, len(src_bytes))
	n2, e := ReadCloser.Read(read_dst_byte)

	fmt.Println("è§£å‹åçš„æ•°æ®çš„å­—èŠ‚æ•°æ˜¯ï¼š", n2)
	fmt.Println("è§£å‹åçš„å­—èŠ‚æ˜¯ï¼š", read_dst_byte)
	fmt.Println("è§£å‹åçš„å­—ç¬¦ä¸²æ˜¯ï¼š", string(read_dst_byte))
	ReadCloser.Close()
	//è¾“å‡ºï¼š
	//	-------è§£å‹å¹¶ä¸”è¯»å–å‡ºæ¥---------
	//	å°†å‹ç¼©æ–‡ä»¶çš„è¯»å†™æŒ‡é’ˆé‡ç½®åˆ°ï¼š 0
	//	è§£å‹åçš„æ•°æ®çš„å­—èŠ‚æ•°æ˜¯ï¼š 597
	//	è§£å‹åçš„å­—èŠ‚æ˜¯ï¼š [97 98 99 228 186 172 228 184 150 229 155 173 228 188 154 231 154 132 229 144 132 229 155 189 230 156 139 229 143
	//		139 232 135 180 228 187 165 232 176 162 230 132 143 227 128 130 228 187 150 232 161 168 231 164 186 239 188 140 230 156 172 229 177
	//		138 228 184 150 229 155 173 228 188 154 228 187 165 226 128 156 231 187 191 232 137 178 231 148 159 230 180 187 239 188 140 231 190
	//		142 228 184 189 229 174 182 229 155 173 226 128 157 228 184 186 228 184 187 233 162 152 239 188 140 231 178 190 229 189 169 231 186
	//		183 229 145 136 227 128 129 230 136 144 230 158 156 228 184 176 231 161 149 227 128 130 13 10 229 156 168 229 188 128 229 185 149 229
	//		188 143 228 184 138 239 188 140 228 184 173 229 155 189 229 155 189 229 174 182 228 184 187 229 184 173 228 185 160 232 191 145 229
	//		185 179 229 128 161 229 175 188 229 133 177 229 144 140 229 187 186 232 174 190 231 190 142 228 184 189 229 156 176 231 144 131 229
	//		174 182 115 100 115 100 115 100 115 100 229 155 173 227 128 129 230 158 132 229 187 186 228 186 186 231 177 187 229 145 189 232 191
	//		144 229 133 177 229 144 140 228 189 147 227 128 130 232 191 153 230 152 175 228 184 128 229 156 186 230 150 135 230 152 142 228 186
	//		146 233 137 180 231 154 132 231 187 191 232 137 178 231 155 155 228 188 154 239 188 140 228 191 131 232 191 155 228 186 134 229 144
	//		132 229 155 189 230 150 135 230 152 142 228 186 164 230 181 129 227 128 129 230 176 145 229 191 131 231 155 184 233 128 154 229 146
	//		140 231 187 191 232 137 178 229 144 136 228 189 156 227 128 130 232 191 153 230 152 175 228 184 128 229 156 186 229 136 155 230 150
	//		176 232 141 159 232 144 131 231 154 132 231 167 145 230 138 128 231 155 155 228 188 154 239 188 140 229 177 149 231 142 176 228 186
	//		134 231 187 191 232 137 178 231 167 145 230 138 128 229 186 148 231 148 168 231 154 132 231 190 142 229 165 189 229 137 141 230 153
	//		175 227 128 130 13 10 232 191 153 230 152 175 228 184 128 229 156 186 232 181 176 232 191 155 232 135 170 231 132 182 231 154 132 228
	//		189 147 233 170 140 231 155 155 228 188 154 239 188 140 228 184 173 229 164 150 232 174 191 229 174 162 231 148 168 229 191 131 230 132
	//		159 229 143 151 231 142 175 228 191 157 228 184 142 229 143 145 229 177 149 231 155 184 228 186 146 228 191 131 232 191 155 227 128 129
	//		228 186 186 228 184 142 232 135 170 231 132 182 229 146 140 232 176 144 229 133 177 229 164 132 231 154 132 231 190 142 229 165 189 97 98 99]
	//	è§£å‹åçš„å­—ç¬¦ä¸²æ˜¯ï¼š abcäº¬ä¸–å›­ä¼šçš„å„å›½æœ‹å‹è‡´ä»¥è°¢æ„ã€‚ä»–è¡¨ç¤ºï¼Œæœ¬å±Šä¸–å›­ä¼šä»¥â€œç»¿è‰²ç”Ÿæ´»ï¼Œç¾ä¸½å®¶å›­â€ä¸ºä¸»é¢˜ï¼Œç²¾å½©çº·å‘ˆã€æˆæœä¸°ç¡•ã€‚
	//	åœ¨å¼€å¹•å¼ä¸Šï¼Œä¸­å›½å›½å®¶ä¸»å¸­ä¹ è¿‘å¹³å€¡å¯¼å…±åŒå»ºè®¾ç¾ä¸½åœ°çƒå®¶sdsdsdsdå›­ã€æ„å»ºäººç±»å‘½è¿å…±åŒä½“ã€‚è¿™æ˜¯ä¸€åœºæ–‡æ˜äº’é‰´çš„ç»¿è‰²ç››ä¼šï¼Œä¿ƒè¿›äº†å„å›½æ–‡æ˜äº¤æµã€æ°‘å¿ƒç›¸é€šå’Œç»¿è‰²åˆä½œã€‚è¿™æ˜¯ä¸€åœºåˆ›æ–°èŸèƒçš„ç§‘æŠ€ç››ä¼šï¼Œå±•ç°äº†ç»¿è‰²ç§‘æŠ€åº”ç”¨çš„ç¾å¥½å‰æ™¯ã€‚
	//	è¿™æ˜¯ä¸€åœºèµ°è¿›è‡ªç„¶çš„ä½“éªŒç››ä¼šï¼Œä¸­å¤–è®¿å®¢ç”¨å¿ƒæ„Ÿå—ç¯ä¿ä¸å‘å±•ç›¸äº’ä¿ƒè¿›ã€äººä¸è‡ªç„¶å’Œè°å…±å¤„çš„ç¾å¥½abc
}
func check_err_zlib(err error) {

	if err != nil {
		fmt.Println(err)
	}
}
